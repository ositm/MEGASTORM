{
  "entities": {
    "User": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "User",
      "type": "object",
      "description": "Represents a user of the LabLink platform.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the User entity."
        },
        "email": {
          "type": "string",
          "description": "User's email address.",
          "format": "email"
        },
        "firstName": {
          "type": "string",
          "description": "User's first name."
        },
        "lastName": {
          "type": "string",
          "description": "User's last name."
        },
        "phoneNumber": {
          "type": "string",
          "description": "User's phone number."
        },
        "createdAt": {
          "type": "string",
          "description": "Timestamp indicating when the user account was created.",
          "format": "date-time"
        },
        "lastLogin": {
          "type": "string",
          "description": "Timestamp indicating the user's last login.",
          "format": "date-time"
        }
      },
      "required": [
        "id",
        "email",
        "firstName",
        "lastName",
        "createdAt"
      ]
    },
    "LabTest": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "LabTest",
      "type": "object",
      "description": "Represents a lab test available at LabLink.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the LabTest entity."
        },
        "name": {
          "type": "string",
          "description": "Name of the lab test."
        },
        "description": {
          "type": "string",
          "description": "Detailed description of the lab test."
        },
        "price": {
          "type": "number",
          "description": "Price of the lab test."
        }
      },
      "required": [
        "id",
        "name",
        "description",
        "price"
      ]
    },
    "Appointment": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "Appointment",
      "type": "object",
      "description": "Represents a scheduled appointment for a lab test.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the Appointment entity."
        },
        "userId": {
          "type": "string",
          "description": "Reference to User. (Relationship: User 1:N Appointment)"
        },
        "labTestId": {
          "type": "string",
          "description": "Reference to LabTest. (Relationship: LabTest 1:N Appointment)"
        },
        "scheduledTime": {
          "type": "string",
          "description": "Scheduled time for the appointment.",
          "format": "date-time"
        },
        "status": {
          "type": "string",
          "description": "Status of the appointment (e.g., scheduled, completed, cancelled)."
        },
        "notes": {
          "type": "string",
          "description": "Any notes that the user has regarding the appointment"
        }
      },
      "required": [
        "id",
        "userId",
        "labTestId",
        "scheduledTime",
        "status"
      ]
    },
    "TestResult": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "TestResult",
      "type": "object",
      "description": "Represents the results of a lab test.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the TestResult entity."
        },
        "appointmentId": {
          "type": "string",
          "description": "Reference to Appointment. (Relationship: Appointment 1:1 TestResult)"
        },
        "result": {
          "type": "string",
          "description": "The raw results of the lab test."
        },
        "dateReceived": {
          "type": "string",
          "description": "Date when the test results were received.",
          "format": "date-time"
        },
        "notes": {
          "type": "string",
          "description": "Any additional notes or observations regarding the test results."
        },
        "normalRange": {
          "type": "string",
          "description": "The normal range for this test result."
        }
      },
      "required": [
        "id",
        "appointmentId",
        "result",
        "dateReceived"
      ]
    }
  },
  "auth": {
    "providers": [
      "password",
      "google.com"
    ]
  },
  "firestore": {
    "structure": [
      {
        "path": "/users/{userId}",
        "definition": {
          "entityName": "User",
          "schema": {
            "$ref": "#/backend/entities/User"
          },
          "description": "Stores user profile information. Path-based ownership ensures only the user (or an admin role not defined) can access their data.",
          "params": [
            {
              "name": "userId",
              "description": "The unique identifier of the user."
            }
          ]
        }
      },
      {
        "path": "/lab_tests/{labTestId}",
        "definition": {
          "entityName": "LabTest",
          "schema": {
            "$ref": "#/backend/entities/LabTest"
          },
          "description": "Stores information about available lab tests. No specific ownership, so accessible with read-only rules, or write rules restricted to an admin role (not defined).",
          "params": [
            {
              "name": "labTestId",
              "description": "The unique identifier of the lab test."
            }
          ]
        }
      },
      {
        "path": "/users/{userId}/appointments/{appointmentId}",
        "definition": {
          "entityName": "Appointment",
          "schema": {
            "$ref": "#/backend/entities/Appointment"
          },
          "description": "Stores appointment information for a user. Path-based ownership ensures only the user can access their appointments.",
          "params": [
            {
              "name": "userId",
              "description": "The unique identifier of the user."
            },
            {
              "name": "appointmentId",
              "description": "The unique identifier of the appointment."
            }
          ]
        }
      },
      {
        "path": "/users/{userId}/appointments/{appointmentId}/test_results/{testResultId}",
        "definition": {
          "entityName": "TestResult",
          "schema": {
            "$ref": "#/backend/entities/TestResult"
          },
          "description": "Stores test results associated with an appointment. Path-based ownership inherited from the appointment ensures only the user can access their test results.",
          "params": [
            {
              "name": "userId",
              "description": "The unique identifier of the user."
            },
            {
              "name": "appointmentId",
              "description": "The unique identifier of the appointment."
            },
            {
              "name": "testResultId",
              "description": "The unique identifier of the test result."
            }
          ]
        }
      }
    ],
    "reasoning": "The Firestore structure prioritizes authorization independence and follows best practices for secure and scalable data management. User data is stored under `/users/{userId}` for path-based ownership. Lab tests, being global data, reside in a root-level collection `/lab_tests`. Appointments are nested under users (`/users/{userId}/appointments/{appointmentId}`) establishing a clear ownership hierarchy. Test results are further nested under appointments (`/users/{userId}/appointments/{appointmentId}/test_results/{testResultId}`). This structure enables simple, robust security rules based on user ID and avoids complex `get()` calls.  The design also implicitly enables QAPs. Listing lab tests (global) is straightforward. Listing user appointments requires knowing the `userId`, preventing unauthorized access to other users' appointments."
  }
}
